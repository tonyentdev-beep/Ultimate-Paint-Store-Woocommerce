(()=>{"use strict";var e={n:t=>{var s=t&&t.__esModule?()=>t.default:()=>t;return e.d(s,{a:s}),s},d:(t,s)=>{for(var i in s)e.o(s,i)&&!e.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:s[i]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=window.wp.element,s=window.wp.apiFetch;var i=e.n(s);const a=window.ReactJSXRuntime,o=({imageUrl:e,selectedColor:t})=>(0,a.jsx)("div",{className:"ps-visualizer",children:e?(0,a.jsxs)("div",{className:"ps-visualizer-container",style:{position:"relative",width:"100%",paddingTop:"75%",backgroundColor:"#eee",overflow:"hidden",borderRadius:"8px"},children:[(0,a.jsx)("img",{src:e,alt:"Room Scene",style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",objectFit:"cover",zIndex:1}}),t&&(0,a.jsx)("div",{className:"ps-color-overlay",style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",backgroundColor:t.hex_value,mixBlendMode:"multiply",zIndex:2}})]}):(0,a.jsx)("div",{style:{padding:"40px",textAlign:"center",background:"#eee",borderRadius:"8px"},children:(0,a.jsx)("p",{children:"No scene image available."})})}),l=({colors:e,selectedColor:s,onColorSelect:i})=>{const[o,l]=(0,t.useState)(""),r=(0,t.useMemo)(()=>{if(!o)return e;const t=o.toLowerCase();return e.filter(e=>e.name.toLowerCase().includes(t)||e.color_code.toLowerCase().includes(t))},[e,o]);return(0,a.jsxs)("div",{className:"ps-color-browser",children:[(0,a.jsx)("h3",{children:"Select a Color"}),(0,a.jsx)("input",{type:"text",placeholder:"Search colors by name or code...",value:o,onChange:e=>l(e.target.value),style:{width:"100%",padding:"10px",marginBottom:"15px"}}),(0,a.jsxs)("div",{className:"ps-color-grid",style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(80px, 1fr))",gap:"10px",maxHeight:"300px",overflowY:"auto"},children:[r.map(e=>(0,a.jsxs)("div",{className:"ps-color-swatch "+(s?.id===e.id?"selected":""),onClick:()=>i(e),style:{cursor:"pointer",border:s?.id===e.id?"2px solid #000":"1px solid #ddd",borderRadius:"4px",overflow:"hidden",textAlign:"center",fontSize:"11px",boxShadow:s?.id===e.id?"0 0 5px rgba(0,0,0,0.3)":"none"},children:[(0,a.jsx)("div",{style:{backgroundColor:e.hex_value,height:"60px",width:"100%"}}),(0,a.jsxs)("div",{style:{padding:"5px"},children:[(0,a.jsx)("div",{style:{fontWeight:"bold"},children:e.color_code}),(0,a.jsx)("div",{style:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:e.name})]})]},e.id)),0===r.length&&(0,a.jsx)("p",{children:"No colors found."})]})]})},r=({attributes:e,selectedSize:t,setSelectedSize:s,selectedSheen:i,setSelectedSheen:o,selectedColor:l})=>{const r=e.sizes&&e.sizes.length>0,d=e.sheens&&e.sheens.length>0;return(0,a.jsxs)("div",{className:"ps-product-options",style:{marginTop:"20px"},children:[!l&&(0,a.jsx)("p",{style:{color:"#999",fontStyle:"italic",margin:"0 0 15px 0"},children:"Select a color to see available sizes and sheens."}),r&&(0,a.jsxs)("div",{style:{marginBottom:"15px"},children:[(0,a.jsx)("label",{style:{display:"block",fontWeight:"bold",marginBottom:"5px"},children:"Size"}),(0,a.jsxs)("select",{value:t,onChange:e=>s(e.target.value),style:{width:"100%",padding:"10px",fontSize:"16px"},children:[(0,a.jsx)("option",{value:"",children:"Choose a size"}),e.sizes.map(e=>(0,a.jsx)("option",{value:e.slug,children:e.name},e.slug))]})]}),d&&(0,a.jsxs)("div",{style:{marginBottom:"15px"},children:[(0,a.jsx)("label",{style:{display:"block",fontWeight:"bold",marginBottom:"5px"},children:"Sheen"}),(0,a.jsxs)("select",{value:i,onChange:e=>o(e.target.value),style:{width:"100%",padding:"10px",fontSize:"16px"},children:[(0,a.jsx)("option",{value:"",children:"Choose a sheen"}),e.sheens.map(e=>(0,a.jsx)("option",{value:e.slug,children:e.name},e.slug))]})]}),l&&!r&&!d&&(0,a.jsx)("p",{style:{color:"#c33",fontStyle:"italic",margin:"0 0 15px 0"},children:"No product options are available for this color combination."})]})},d=({familyId:e,variations:s,selectedSize:o,selectedSheen:l,selectedColor:r})=>{const[d,n]=(0,t.useState)(!1),[c,p]=(0,t.useState)("");let u="";if(o&&l){const e=s.find(e=>e.attributes.attribute_pa_paint_size===o&&e.attributes.attribute_pa_paint_sheen===l);e&&e.price_html&&(u=e.price_html)}return(0,a.jsxs)("div",{className:"ps-add-to-cart-wrapper",style:{marginTop:"30px",padding:"20px",background:"#f5f5f5",borderRadius:"8px"},children:[(0,a.jsx)("div",{style:{marginBottom:"15px"},dangerouslySetInnerHTML:{__html:u}}),(0,a.jsx)("button",{className:"button alt",onClick:async()=>{if(!o||!l)return void p("Please select a Size and Sheen.");if(!r)return void p("Please select a Color.");const t=s.find(e=>e.attributes.attribute_pa_paint_size===o&&e.attributes.attribute_pa_paint_sheen===l);if(t){n(!0),p("");try{(await i()({path:"/paint-store/v1/public/add-to-cart",method:"POST",data:{product_id:e,variation_id:t.id,quantity:1,color_hex:r.hex_value,color_name:`${r.name} (${r.color_code})`}})).success?(p("✅ Added to cart successfully!"),"undefined"!=typeof jQuery&&(jQuery(document.body).trigger("wc_fragment_refresh"),jQuery(document.body).trigger("added_to_cart"))):p("❌ Failed to add to cart.")}catch(e){console.error("Error adding to cart:",e),p(`❌ Error: ${e.message||"Failed to add to cart."}`)}n(!1)}else p("This combination of size and sheen is currently unavailable.")},disabled:d||!o||!l||!r,style:{width:"100%",padding:"15px",fontSize:"18px",fontWeight:"bold"},children:d?"Adding...":"Add to Cart"}),c&&(0,a.jsx)("div",{style:{marginTop:"15px",fontWeight:"bold",color:c.includes("✅")?"#0f834d":"#d63638"},children:c})]})},n=({familyId:e})=>{const[s,n]=(0,t.useState)(!0),[c,p]=(0,t.useState)(null),[u,h]=(0,t.useState)([]),[x,m]=(0,t.useState)(""),[g,b]=(0,t.useState)(""),[f,y]=(0,t.useState)(null);(0,t.useEffect)(()=>{e&&(async()=>{try{const[t,s]=await Promise.all([i()({path:`/paint-store/v1/public/product-families/${e}`}),i()({path:"/paint-store/v1/public/colors"})]);p(t),h(s)}catch(e){console.error("Error fetching builder data:",e)}finally{n(!1)}})()},[e]);const v=(0,t.useMemo)(()=>c&&c.ps_products?f&&f.base_ids&&0!==f.base_ids.length?c.ps_products.filter(e=>f.base_ids.includes(e.base_id)):c.ps_products:[],[c,f]),_=(0,t.useMemo)(()=>v.map(e=>e.woo_product_id).filter(e=>e>0),[v]),j=(0,t.useMemo)(()=>c&&c.variations?0===_.length?c.variations:c.variations.filter(e=>_.includes(e.id)):[],[c,_]),S=(0,t.useMemo)(()=>{if(!c||!c.attributes)return{sizes:[],sheens:[]};const e=new Set,t=new Set;return j.forEach(s=>{s.attributes&&s.attributes.attribute_pa_paint_size&&e.add(s.attributes.attribute_pa_paint_size),s.attributes&&s.attributes.attribute_pa_paint_sheen&&t.add(s.attributes.attribute_pa_paint_sheen)}),{sizes:e.size>0?c.attributes.sizes.filter(t=>e.has(t.slug)):c.attributes.sizes,sheens:t.size>0?c.attributes.sheens.filter(e=>t.has(e.slug)):c.attributes.sheens}},[c,j]);return(0,t.useEffect)(()=>{x&&!S.sizes.find(e=>e.slug===x)&&m(""),g&&!S.sheens.find(e=>e.slug===g)&&b("")},[S]),e?s?(0,a.jsx)("div",{className:"ps-builder-loading",style:{padding:"40px",textAlign:"center"},children:"Loading Product Data..."}):c&&c.family?(0,a.jsxs)("div",{className:"paint-store-product-builder",children:[(0,a.jsx)("h2",{style:{marginBottom:"5px"},children:c.family.name}),(0,a.jsx)("p",{style:{color:"#666",marginTop:0},dangerouslySetInnerHTML:{__html:c.family.description}}),(0,a.jsxs)("div",{style:{display:"flex",flexWrap:"wrap",gap:"30px",marginTop:"30px"},children:[(0,a.jsxs)("div",{style:{flex:"1 1 300px",maxWidth:"400px"},children:[(0,a.jsx)(o,{imageUrl:c.family.image_url,selectedColor:f}),(0,a.jsx)(r,{attributes:S,selectedSize:x,setSelectedSize:m,selectedSheen:g,setSelectedSheen:b,selectedColor:f}),(0,a.jsx)(d,{familyId:c.family.wc_product_id,variations:j,selectedSize:x,selectedSheen:g,selectedColor:f})]}),(0,a.jsx)("div",{style:{flex:"2 1 400px"},children:(0,a.jsx)(l,{colors:u,selectedColor:f,onColorSelect:y})})]})]}):(0,a.jsx)("div",{className:"ps-builder-error",children:"Error: Failed to load Product Family data."}):(0,a.jsx)("div",{className:"ps-builder-error",children:"Error: No Product Family ID provided."})};document.addEventListener("DOMContentLoaded",()=>{const e=document.getElementById("paint-store-builder-root");if(e){const s=e.getAttribute("data-family-id");(0,t.render)((0,a.jsx)(n,{familyId:s}),e)}})})();