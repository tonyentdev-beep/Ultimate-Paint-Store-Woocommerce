(()=>{"use strict";var e={n:t=>{var s=t&&t.__esModule?()=>t.default:()=>t;return e.d(s,{a:s}),s},d:(t,s)=>{for(var i in s)e.o(s,i)&&!e.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:s[i]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=window.wp.element,s=window.wp.apiFetch;var i=e.n(s);const l=window.ReactJSXRuntime,o=({imageUrl:e,selectedColor:t})=>(0,l.jsx)("div",{className:"ps-visualizer",children:e?(0,l.jsxs)("div",{className:"ps-visualizer-container",style:{position:"relative",width:"100%",paddingTop:"75%",backgroundColor:"#eee",overflow:"hidden",borderRadius:"8px"},children:[(0,l.jsx)("img",{src:e,alt:"Room Scene",style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",objectFit:"cover",zIndex:1}}),t&&(0,l.jsx)("div",{className:"ps-color-overlay",style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",backgroundColor:t.hex_value,mixBlendMode:"multiply",zIndex:2}})]}):(0,l.jsx)("div",{style:{padding:"40px",textAlign:"center",background:"#eee",borderRadius:"8px"},children:(0,l.jsx)("p",{children:"No scene image available."})})}),r=({colors:e,selectedColor:s,onColorSelect:i})=>{const[o,r]=(0,t.useState)(""),a=(0,t.useMemo)(()=>{if(!o)return e;const t=o.toLowerCase();return e.filter(e=>e.name.toLowerCase().includes(t)||e.color_code.toLowerCase().includes(t))},[e,o]);return(0,l.jsxs)("div",{className:"ps-color-browser",children:[(0,l.jsx)("h3",{children:"Select a Color"}),(0,l.jsx)("input",{type:"text",placeholder:"Search colors by name or code...",value:o,onChange:e=>r(e.target.value),style:{width:"100%",padding:"10px",marginBottom:"15px"}}),(0,l.jsxs)("div",{className:"ps-color-grid",style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(80px, 1fr))",gap:"10px",maxHeight:"300px",overflowY:"auto"},children:[a.map(e=>(0,l.jsxs)("div",{className:"ps-color-swatch "+(s?.id===e.id?"selected":""),onClick:()=>i(e),style:{cursor:"pointer",border:s?.id===e.id?"2px solid #000":"1px solid #ddd",borderRadius:"4px",overflow:"hidden",textAlign:"center",fontSize:"11px",boxShadow:s?.id===e.id?"0 0 5px rgba(0,0,0,0.3)":"none"},children:[(0,l.jsx)("div",{style:{backgroundColor:e.hex_value,height:"60px",width:"100%"}}),(0,l.jsxs)("div",{style:{padding:"5px"},children:[(0,l.jsx)("div",{style:{fontWeight:"bold"},children:e.color_code}),(0,l.jsx)("div",{style:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:e.name})]})]},e.id)),0===a.length&&(0,l.jsx)("p",{children:"No colors found."})]})]})},a=({attributes:e,selectedSize:t,setSelectedSize:s,selectedSheen:i,setSelectedSheen:o,selectedColor:r,shouldFilter:a})=>{const d=e.sizes&&e.sizes.length>0,n=e.sheens&&e.sheens.length>0;return(0,l.jsxs)("div",{className:"ps-product-options",style:{marginTop:"20px"},children:[d&&(0,l.jsxs)("div",{style:{marginBottom:"15px"},children:[(0,l.jsx)("label",{style:{display:"block",fontWeight:"bold",marginBottom:"5px"},children:"Size"}),(0,l.jsxs)("select",{value:t,onChange:e=>s(e.target.value),style:{width:"100%",padding:"10px",fontSize:"16px"},children:[(0,l.jsx)("option",{value:"",children:"Choose a size"}),e.sizes.map(e=>(0,l.jsx)("option",{value:e.slug,children:e.name},e.slug))]})]}),n&&(0,l.jsxs)("div",{style:{marginBottom:"15px"},children:[(0,l.jsx)("label",{style:{display:"block",fontWeight:"bold",marginBottom:"5px"},children:"Sheen"}),(0,l.jsxs)("select",{value:i,onChange:e=>o(e.target.value),style:{width:"100%",padding:"10px",fontSize:"16px"},children:[(0,l.jsx)("option",{value:"",children:"Choose a sheen"}),e.sheens.map(e=>(0,l.jsx)("option",{value:e.slug,children:e.name},e.slug))]})]}),a&&r&&!d&&!n&&(0,l.jsx)("p",{style:{color:"#c33",fontStyle:"italic",margin:"0 0 15px 0"},children:"No product options are available for this color combination."})]})},d=({familyId:e,variations:s,selectedSize:o,selectedSheen:r,selectedColor:a,validProducts:d})=>{const[n,c]=(0,t.useState)(!1),[p,u]=(0,t.useState)(""),h=o&&r?s.find(e=>e.attributes.attribute_pa_paint_size===o&&e.attributes.attribute_pa_paint_sheen===r):null,x=o&&r&&d?d.find(e=>e.size_slug===o&&e.sheen_slug===r):null;let m="";return x&&x.price>0?m="$"+parseFloat(x.price).toFixed(2):h&&h.price>0&&(m=h.price_html||"$"+parseFloat(h.price).toFixed(2)),(0,l.jsxs)("div",{className:"ps-add-to-cart-wrapper",style:{marginTop:"30px",padding:"20px",background:"#f5f5f5",borderRadius:"8px"},children:[m&&(0,l.jsx)("div",{style:{marginBottom:"15px",fontSize:"24px",fontWeight:"bold",color:"#111"},children:m}),(0,l.jsx)("button",{className:"button alt",onClick:async()=>{if(o&&r)if(a)if(h){c(!0),u("");try{(await i()({path:"/paint-store/v1/public/add-to-cart",method:"POST",data:{product_id:e,variation_id:h.id,quantity:1,color_hex:a.hex_value,color_name:`${a.name} (${a.color_code})`}})).success?(u("✅ Added to cart successfully!"),"undefined"!=typeof jQuery&&(jQuery(document.body).trigger("wc_fragment_refresh"),jQuery(document.body).trigger("added_to_cart"))):u("❌ Failed to add to cart.")}catch(e){console.error("Error adding to cart:",e),u(`❌ Error: ${e.message||"Failed to add to cart."}`)}c(!1)}else u("This combination of size and sheen is currently unavailable.");else u("Please select a Color.");else u("Please select a Size and Sheen.")},disabled:n||!o||!r||!a,style:{width:"100%",padding:"15px",fontSize:"18px",fontWeight:"bold"},children:n?"Adding...":"Add to Cart"}),p&&(0,l.jsx)("div",{style:{marginTop:"15px",fontWeight:"bold",color:p.includes("✅")?"#0f834d":"#d63638"},children:p})]})},n=({familyId:e})=>{const[s,n]=(0,t.useState)(!0),[c,p]=(0,t.useState)(null),[u,h]=(0,t.useState)([]),[x,m]=(0,t.useState)(""),[g,f]=(0,t.useState)(""),[b,y]=(0,t.useState)(null);(0,t.useEffect)(()=>{e&&(async()=>{try{const[t,s]=await Promise.all([i()({path:`/paint-store/v1/public/product-families/${e}`}),i()({path:"/paint-store/v1/public/colors"})]);p(t),h(s)}catch(e){console.error("Error fetching builder data:",e)}finally{n(!1)}})()},[e]);const v=c&&c.ps_products&&c.ps_products.length>0,j=v&&b&&b.base_ids&&b.base_ids.length>0,_=(0,t.useMemo)(()=>v?j?c.ps_products.filter(e=>b.base_ids.includes(e.base_id)):c.ps_products:[],[c,b,v,j]),S=(0,t.useMemo)(()=>{if(!c||!c.attributes)return{sizes:[],sheens:[]};if(!j)return c.attributes;const e={},t={};_.forEach(s=>{s.size_slug&&(e[s.size_slug]=s.size_name),s.sheen_slug&&(t[s.sheen_slug]=s.sheen_name)});const s=Object.keys(e).map(t=>({slug:t,name:e[t]})),i=Object.keys(t).map(e=>({slug:e,name:t[e]}));return 0===s.length&&0===i.length?c.attributes:{sizes:s,sheens:i}},[c,_,j]),w=(0,t.useMemo)(()=>{if(!c||!c.variations)return[];if(!j)return c.variations;const e=new Set(S.sizes.map(e=>e.slug)),t=new Set(S.sheens.map(e=>e.slug)),s=c.variations.filter(s=>{const i=s.attributes&&s.attributes.attribute_pa_paint_size,l=s.attributes&&s.attributes.attribute_pa_paint_sheen,o=!i||e.has(i),r=!l||t.has(l);return o&&r});return s.length>0?s:c.variations},[c,S,j]);return(0,t.useEffect)(()=>{j&&(x&&!S.sizes.find(e=>e.slug===x)&&m(""),g&&!S.sheens.find(e=>e.slug===g)&&f(""))},[S,j]),e?s?(0,l.jsx)("div",{className:"ps-builder-loading",style:{padding:"40px",textAlign:"center"},children:"Loading Product Data..."}):c&&c.family?(0,l.jsxs)("div",{className:"paint-store-product-builder",children:[(0,l.jsx)("h2",{style:{marginBottom:"5px"},children:c.family.name}),(0,l.jsx)("p",{style:{color:"#666",marginTop:0},dangerouslySetInnerHTML:{__html:c.family.description}}),(0,l.jsxs)("div",{style:{display:"flex",flexWrap:"wrap",gap:"30px",marginTop:"30px"},children:[(0,l.jsxs)("div",{style:{flex:"1 1 300px",maxWidth:"400px"},children:[(0,l.jsx)(o,{imageUrl:c.family.image_url,selectedColor:b}),(0,l.jsx)(a,{attributes:S,selectedSize:x,setSelectedSize:m,selectedSheen:g,setSelectedSheen:f,selectedColor:b,shouldFilter:j}),(0,l.jsx)(d,{familyId:c.family.wc_product_id,variations:w,selectedSize:x,selectedSheen:g,selectedColor:b,validProducts:_})]}),(0,l.jsx)("div",{style:{flex:"2 1 400px"},children:(0,l.jsx)(r,{colors:u,selectedColor:b,onColorSelect:y})})]})]}):(0,l.jsx)("div",{className:"ps-builder-error",children:"Error: Failed to load Product Family data."}):(0,l.jsx)("div",{className:"ps-builder-error",children:"Error: No Product Family ID provided."})};document.addEventListener("DOMContentLoaded",()=>{const e=document.getElementById("paint-store-builder-root");if(e){const s=e.getAttribute("data-family-id");(0,t.render)((0,l.jsx)(n,{familyId:s}),e)}})})();